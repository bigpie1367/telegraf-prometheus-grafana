[agent]
  interval = "15s"
  round_interval = true
  collection_jitter = "0s"
  debug = false

[[inputs.system]]

[[inputs.diskio]]
  skip_serial_number = true

[[inputs.mem]]

[[inputs.net]]
  ignore_protocol_stats = true

[[inputs.cpu]]
  percpu = true
  totalcpu = true
  report_active = true
  collect_cpu_time = true

[[inputs.docker]]
  endpoint = "unix:///var/run/docker.sock"
  container_name_include  = []
  storage_objects = ["container", "volume"]
  perdevice_include = ["cpu", "blkio", "network"]
  total_include = ["cpu", "blkio", "network"]
  timeout = "5s"
  gather_services = false

[[inputs.exec]]
  commands = ["/app/check_docker.sh"]
  timeout = "5s"
  data_format = "prometheus"

[[inputs.exec]]
  commands = ["/app/check_cert.sh"]
  timeout = "5s"
  data_format = "prometheus"

# 여러 로그 파일 수집 설정 (Nginx 접근 로그와 오류 로그)
[[inputs.tail]]
  files = [
    "/var/log/nginx/access.log",
    "/var/log/nginx/error.log"
  ]
  from_beginning = false
  name_override = "nginx_logs"
  data_format = "grok"
  grok_patterns = ["%{COMMONAPACHELOG}"]

[[outputs.prometheus_client]]
  listen = ":9273"
  path = "/metrics"

# Elasticsearch Output (로그 데이터)
[[outputs.elasticsearch]]
  urls = ["http://192.168.1.157:9200"]
  index_name = "nginx-logs"
  timeout = "5s"
